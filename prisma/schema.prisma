// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider      = "prisma-client"
  output        = "../generated/prisma"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum AssetType {
  VEHICLE
  CHASSIS
  EQUIPMENT
  OFFICE_TOOL
}

enum ChassisType {
  RANGKA
  FLATBED
  DECK_KAYU
}

model User {
  id           String        @id @default(uuid()) @db.Char(36)
  fullname     String
  username     String        @unique
  password     String
  role         Role          @default(USER)
  createdAt    DateTime      @default(now())
  maintenences Maintenence[]
  is_active    Boolean       @default(true)

  @@map("users")
}

model Driver {
  id            String        @id @default(uuid()) @db.Char(36)
  driver_number String
  name          String
  phone         String
  notes         String?
  is_active     Boolean
  createdAt     DateTime      @default(now())
  sim_due_date  DateTime?
  maintenences  Maintenence[]

  @@map("drivers")
}

model Asset {
  id             String        @id @default(uuid()) @db.Char(36)
  asset_code     String
  name           String
  asset_type     AssetType
  brand          String?
  model          String?
  serrial_number String?
  purchase_date  DateTime?
  purchase_price Int?
  is_active      Boolean
  createdAt      DateTime      @default(now())
  vehicle        Vehicle?
  chassis        Chassis?
  equipment      Equipment?
  maintenences   Maintenence[]

  @@map("assets")
}

model Vehicle {
  id            String    @id @default(uuid()) @db.Char(36)
  license_plate String?
  color         String?
  year          Int?
  engine_number String?
  frame_number  String?
  no_kir        String?
  kir_due_date  DateTime?
  stnk_due_date DateTime?
  notes         String?
  createdAt     DateTime  @default(now())
  asset_id      String    @unique @db.Char(36)
  asset         Asset     @relation(fields: [asset_id], references: [id])

  @@map("vehicles")
}

model Chassis {
  id               String      @id @default(uuid()) @db.Char(36)
  chassis_number   String
  chassis_type     ChassisType
  chassis_category String // 20 feat, 40 feat lowbed, dolly, other
  axle_count       Int
  no_kir           String?
  kir_due_date     DateTime?
  notes            String?
  color            String?
  owner            String?
  address          String?
  createdAt        DateTime    @default(now())
  asset_id         String      @unique @db.Char(36)
  asset            Asset       @relation(fields: [asset_id], references: [id])

  @@map("chassises")
}

model Equipment {
  id             String   @id @default(uuid()) @db.Char(36)
  equipment_code String
  equipment_type String
  specification  String
  condition      String
  createdAt      DateTime @default(now())
  asset_id       String   @unique @db.Char(36)
  asset          Asset    @relation(fields: [asset_id], references: [id])

  @@map("equipments")
}

model Sparepart {
  id                    String                 @id @default(uuid()) @db.Char(36)
  code                  String
  name                  String
  unit                  String
  price                 Int
  stock_quantity        Int
  description           String
  createdAt             DateTime               @default(now())
  maintenenceSpareparts MaintenenceSparepart[]

  @@map("spareparts")
}

model Maintenence {
  id              String                 @id @default(uuid()) @db.Char(36)
  record_number   String
  user_id         String                 @db.Char(36)
  user            User                   @relation(fields: [user_id], references: [id])
  complaint       String
  repair_notes    String
  driver_id       String?                @db.Char(36)
  driver          Driver?                @relation(fields: [driver_id], references: [id])
  asset_id        String                 @db.Char(36)
  asset           Asset                  @relation(fields: [asset_id], references: [id])
  km_asset        Int?
  total_cost      Int
  labor_cost      Int
  spareparts_cost Int
  asset_image_url String
  location        String?
  createdAt       DateTime               @default(now())
  spareparts      MaintenenceSparepart[]
  images          MaintenenceImage[]

  @@map("maintenences")
}

model Image {
  id           String             @id @default(uuid()) @db.Char(36)
  url          String
  alt          String?
  createdAt    DateTime           @default(now())
  maintenences MaintenenceImage[]

  @@map("images")
}

model MaintenenceImage {
  id             String      @id @default(uuid()) @db.Char(36)
  maintenence_id String      @db.Char(36)
  image_id       String      @db.Char(36)
  maintenence    Maintenence @relation(fields: [maintenence_id], references: [id])
  image          Image       @relation(fields: [image_id], references: [id])
  createdAt      DateTime    @default(now())

  @@unique([maintenence_id, image_id])
  @@map("maintenence_images")
}

model MaintenenceSparepart {
  id             String      @id @default(uuid()) @db.Char(36)
  maintenence_id String      @db.Char(36)
  sparepart_id   String      @db.Char(36)
  total          Int         @default(0)
  maintenence    Maintenence @relation(fields: [maintenence_id], references: [id])
  sparepart      Sparepart   @relation(fields: [sparepart_id], references: [id])
  createdAt      DateTime    @default(now())

  @@unique([maintenence_id, sparepart_id])
  @@map("maintenence_spareparts")
}
